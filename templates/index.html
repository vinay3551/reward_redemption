<!doctype html>
<!-- <html lang="en">
<meta charset="UTF-8">
<title>iTeach PDU - Pcoin Aution</title>
<style>
  body { font-family: 'Arial', sans-serif; background: linear-gradient(to bottom, #fff8dc, #8b0000); color: #4b0000; margin:0; padding:0; }
  header { text-align:center; padding:40px 20px 20px 20px; background-color:#8b0000; color:gold; box-shadow:0 4px 8px rgba(0,0,0,0.2); }
  header h1{margin:0;font-size:3em;font-weight:bold;} header p{font-size:1.5em;font-style:italic;opacity:0.7;}
  .container{max-width:700px;margin:40px auto;background-color:#fff8dc;padding:30px;border-radius:15px;box-shadow:0 4px 10px rgba(0,0,0,0.2);position:relative;}
  input[type=text]{width:100%;padding:12px;font-size:1em;border:2px solid #8b0000;border-radius:8px;margin-bottom:10px;}
  button{background-color:#8b0000;color:gold;border:none;padding:12px 25px;font-size:1em;cursor:pointer;border-radius:8px;transition:0.3s;}
  button:hover{background-color:gold;color:#8b0000;}
  .card{border:2px solid #8b0000;border-radius:10px;padding:10px;margin:5px;display:inline-block;background-color:#fff;cursor:pointer;transition:transform 0.2s;}
  .card:hover{transform:scale(1.05);box-shadow:0 4px 8px rgba(0,0,0,0.3);}
  #studentInfo{margin-top:20px;}
  #autocompleteList{border:1px solid #8b0000;background:#fff;max-height:150px;overflow-y:auto;margin-top:-5px;border-radius:5px;}
  #autocompleteList div{padding:8px;cursor:pointer;}
  #autocompleteList div:hover{background-color:gold;color:#8b0000;}
  .error{color:red;margin-top:10px;font-weight:bold;}
  .success{color:green;margin-top:10px;font-weight:bold;}
  .qtyInput{width:50px;margin-left:10px;}
</style>
<body>
<header>
  <h1>iTeach PDU</h1>
  <p>"This is SPARTA"</p>
</header>
<div class="container">
  <h2>  Welcome to Unit 1 PCoin Auction </h2>
  <input id="studentName" placeholder="Enter student name" oninput="autocompleteStudent()" autocomplete="off"/>
  <div id="autocompleteList"></div>
  <div id="studentInfo" style="display:none;">
    <h3 id="studentDetails" data-coins="0"></h3>
    <div id="prizeList">
      <h4> Prizes</h4>
      {% for prize, cost in prizes.items() %}
        <div class="card">
          {{ prize }} ({{ cost }} PCoins)
          <input type="number" min="0" value="0" class="prizeQty qtyInput" data-prize="{{ prize }}" data-cost="{{ cost }}" />
        </div>
      {% endfor %}
    </div>
    <br/>
    <button onclick="redeemPrizes()">Redeem</button>
  </div>
  <p id="message"></p>
</div>
<script>
let currentStudent = "";
function showMsg(text, cls=""){const el=document.getElementById("message");el.className=cls;el.textContent=text;}
function autocompleteStudent(){
  const input=document.getElementById("studentName").value.trim();
  const listDiv=document.getElementById("autocompleteList");
  listDiv.innerHTML="";
  if(!input) return;
  fetch("/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:input})})
  .then(r=>r.json())
  .then(data=>{if(data.matches){data.matches.forEach(name=>{const div=document.createElement("div");div.textContent=name;div.onclick=()=>selectStudent(name);listDiv.appendChild(div);});} else if(data.name){selectStudent(data.name);}});
}
function selectStudent(name){currentStudent=name;document.getElementById("studentName").value=name;document.getElementById("autocompleteList").innerHTML="";fetchStudentDetails(name);}
function fetchStudentDetails(name){
  fetch("/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name})})
  .then(r=>r.json())
  .then(data=>{if(!data.error&&data.name){document.getElementById("studentDetails").innerText=`${data.name} ‚Äî ${data.coins} PCoins`;document.getElementById("studentDetails").dataset.coins=data.coins;document.getElementById("studentInfo").style.display="block";}});
}
function redeemPrizes(){
  if(!currentStudent){showMsg("Search student first","error");return;}
  let prizes={}; let totalCost=0;
  document.querySelectorAll(".prizeQty").forEach(input=>{const qty=parseInt(input.value)||0;if(qty>0){const prize=input.dataset.prize;const cost=parseInt(input.dataset.cost);prizes[prize]=qty;totalCost+=qty*cost;}});
  if(Object.keys(prizes).length===0){showMsg("Select at least one prize","error");return;}
  const currentCoins=parseInt(document.getElementById("studentDetails").dataset.coins);
  if(totalCost>currentCoins){showMsg(`Not enough coins! Total cost: ${totalCost}, Available: ${currentCoins}`,"error");return;}
  fetch("/redeem",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:currentStudent,prizes:prizes})})
  .then(r=>r.json())
  .then(data=>{if(data.error) showMsg(data.error,"error");else{showMsg("Redeemed! Remaining coins: "+data.remaining,"success");document.getElementById("studentDetails").innerText=`${currentStudent} ‚Äî ${data.remaining} PCoins`;document.getElementById("studentDetails").dataset.coins=data.remaining;document.querySelectorAll(".prizeQty").forEach(i=>i.value=0);}});
}
</script>
</body>
</html>
-->

<!doctype html>
<html lang="en">
<meta charset="UTF-8">
<title>iTeach PDU - Pcoin Aution</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Fredoka+One:wght@400&family=Inter:wght@400;600;700&display=swap');
  
  body { 
    font-family: 'Inter', sans-serif; 
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
    background-attachment: fixed;
    color: #2d3748; 
    margin:0; 
    padding:0; 
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    background: #fffbea;
    font-family: Arial, sans-serif;
  }

  
  header { 
    text-align:center; 
    padding:50px 20px 30px 20px; 
    background: linear-gradient(135deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
    background-size: 400% 400%;
    animation: gradientShift 3s ease infinite;
    color:#fff; 
    box-shadow:0 8px 25px rgba(0,0,0,0.3);
    position: relative;
    overflow: hidden;
  }
  
  @keyframes gradientShift {
    0%, 100% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
  }
  
  header::before {
    content: 'üèÜ';
    position: absolute;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 3em;
    animation: bounce 2s infinite;
  }
  
  @keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
    40% { transform: translateX(-50%) translateY(-10px); }
    60% { transform: translateX(-50%) translateY(-5px); }
  }
  
  header h1{
    margin:0;
    font-family: 'Fredoka One', cursive;
    font-size:3.5em;
    font-weight:bold;
    text-shadow: 3px 3px 0px rgba(0,0,0,0.3);
    margin-top: 60px;
  } 
  
  header p{
    font-size:1.8em;
    font-style:italic;
    opacity:0.9;
    font-weight: 600;
    text-shadow: 2px 2px 0px rgba(0,0,0,0.2);
  }
  .search-wrapper {
      width: 100%;
      max-width: 600px;
    }

    .search-box {
      display: flex;
      align-items: center;
      background: #fff;
      border-radius: 999px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      padding: 8px 14px;
      border: 1px solid #ccc;
    }

    .search-box input {
      flex: 1;
      border: none;
      outline: none;
      font-size: 16px;
      padding: 6px 10px;
      background: transparent;
    }

    .search-box button {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: #8b0000; /* maroon */
    }

    .search-box button:hover {
      color: goldenrod; /* gold hover */
    }
  
  .container{
    max-width:800px;
    margin:40px auto;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    padding:40px;
    border-radius:25px;
    box-shadow:0 15px 35px rgba(0,0,0,0.1);
    position:relative;
    border: 3px solid rgba(255,215,0,0.3);
  }
  
  .container::before {
    content: '';
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    background: linear-gradient(45deg, #ffd700, #ff6b6b, #4ecdc4, #45b7d1);
    border-radius: 25px;
    z-index: -1;
    opacity: 0.7;
  }
  
  h2 {
    text-align: center;
    color: #2d3748;
    font-family: 'Fredoka One', cursive;
    font-size: 2.2em;
    margin-bottom: 30px;
    text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
  }
  
  .search-container {
    position: relative;
    margin-bottom: 20px;
  }
  
  .search-container::before {
    content: 'üîç';
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.2em;
    z-index: 2;
    transition: all 0.3s ease;
  }
  
  input[type=text]{
    width:100%;
    padding:15px 15px 15px 50px;
    font-size:1.1em;
    border:3px solid #e2e8f0;
    border-radius:15px;
    margin-bottom:15px;
    transition: all 0.3s ease;
    background: rgba(255,255,255,0.8);
    position: relative;
  }
  
  input[type=text]:focus {
    outline: none;
    border-color: #667eea;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1), 0 5px 20px rgba(102, 126, 234, 0.2);
    transform: scale(1.02);
    background: rgba(255,255,255,0.95);
  }
  
  input[type=text]:focus + .search-hint {
    opacity: 1;
    transform: translateY(0);
  }
  
  .search-hint {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
    padding: 8px 15px;
    border-radius: 10px;
    font-size: 0.9em;
    color: #667eea;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    z-index: 1;
    font-weight: 500;
  }
  
  .loading-indicator {
    position: absolute;
    right: 15px;
    top: 50%;
    transform: translateY(-50%);
    opacity: 0;
    transition: all 0.3s ease;
  }
  
  .loading-indicator.show {
    opacity: 1;
  }
  
  @keyframes spin {
    0% { transform: translateY(-50%) rotate(0deg); }
    100% { transform: translateY(-50%) rotate(360deg); }
  }
  
  .loading-indicator.show {
    animation: spin 1s linear infinite;
  }
  
  button{
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    border:none;
    padding:15px 30px;
    font-size:1.2em;
    font-weight: 600;
    cursor:pointer;
    border-radius:15px;
    transition: all 0.3s ease;
    box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    position: relative;
    overflow: hidden;
  }
  
  button::before {
    content: '‚ú®';
    position: absolute;
    left: -100%;
    top: 50%;
    transform: translateY(-50%);
    transition: all 0.3s ease;
  }
  
  button:hover {
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
  }
  
  button:hover::before {
    left: 10px;
  }
  
  button:active {
    transform: translateY(-1px) scale(1.02);
  }
  
  .card{
    border:3px solid #e2e8f0;
    border-radius:15px;
    padding:15px;
    margin:8px;
    display:inline-block;
    background: linear-gradient(135deg, rgba(255,255,255,0.9), rgba(248,250,252,0.9));
    cursor:pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    font-weight: 600;
  }
  
  .card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,215,0,0.4), transparent);
    transition: all 0.5s ease;
  }
  
  .card:hover {
    transform: translateY(-5px) scale(1.05);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    border-color: #ffd700;
  }
  
  .card:hover::before {
    left: 100%;
  }
  
  #studentInfo{
    margin-top:30px;
    padding: 25px;
    background: linear-gradient(135deg, rgba(72, 219, 251, 0.1), rgba(255, 159, 243, 0.1));
    border-radius: 20px;
    border: 2px solid rgba(255,215,0,0.3);
  }
  
  #studentDetails {
    font-size: 1.4em;
    font-weight: 700;
    color: #2d3748;
    text-align: center;
    margin-bottom: 20px;
    padding: 15px;
    background: linear-gradient(135deg, rgba(255,215,0,0.2), rgba(255,255,255,0.8));
    border-radius: 15px;
    border: 2px solid #ffd700;
    position: relative;
  }
  
  #studentDetails::before {
    content: 'üí∞';
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.2em;
  }
  
  #autocompleteList{
    border:2px solid #e2e8f0;
    background: rgba(255,255,255,0.98);
    backdrop-filter: blur(10px);
    max-height:250px;
    overflow-y:auto;
    margin-top:-5px;
    border-radius:15px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
    z-index: 100;
    position: relative;
  }
  
  #autocompleteList:empty {
    display: none;
  }
  
  #autocompleteList div{
    padding:15px 20px;
    cursor:pointer;
    transition: all 0.3s ease;
    font-weight: 500;
    border-bottom: 1px solid rgba(226, 232, 240, 0.5);
    position: relative;
    overflow: hidden;
  }
  
  #autocompleteList div:last-child {
    border-bottom: none;
  }
  
  #autocompleteList div::before {
    content: 'üë§';
    margin-right: 10px;
    opacity: 0.7;
  }
  
  #autocompleteList div:hover{
    background: linear-gradient(135deg, #667eea, #764ba2);
    color: white;
    transform: translateX(5px);
    box-shadow: 0 3px 10px rgba(102, 126, 234, 0.3);
  }
  
  #autocompleteList div:hover::before {
    opacity: 1;
  }
  
  .no-results {
    padding: 20px;
    text-align: center;
    color: #a0aec0;
    font-style: italic;
  }
  
  .no-results::before {
    content: 'ü§î';
    display: block;
    font-size: 2em;
    margin-bottom: 10px;
  }
  
  .error{
    color: #e53e3e;
    margin-top:15px;
    font-weight: bold;
    padding: 10px;
    background: rgba(229, 62, 62, 0.1);
    border-radius: 10px;
    border-left: 4px solid #e53e3e;
  }
  
  .success{
    color: #38a169;
    margin-top:15px;
    font-weight: bold;
    padding: 15px;
    background: linear-gradient(135deg, rgba(56, 161, 105, 0.1), rgba(104, 211, 145, 0.1));
    border-radius: 15px;
    border: 2px solid #38a169;
    position: relative;
    animation: celebration 0.6s ease;
  }
  
  .success::before {
    content: 'üéâ';
    position: absolute;
    left: 15px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 1.3em;
  }
  
  @keyframes celebration {
    0% { transform: scale(0.8); opacity: 0; }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); opacity: 1; }
  }
  
  .qtyInput{
    width:60px;
    margin-left:15px;
    padding: 5px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    text-align: center;
    font-weight: 600;
  }
  
  h4 {
    color: #2d3748;
    font-family: 'Fredoka One', cursive;
    font-size: 1.5em;
    text-align: center;
    margin-bottom: 20px;
    position: relative;
  }
  
  h4::before, h4::after {
    content: 'üéÅ';
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
  }
  
  h4::before { left: -40px; }
  h4::after { right: -40px; }
  
  /* Sparkle animation for achievements */
  @keyframes sparkle {
    0%, 100% { opacity: 0; transform: scale(0.5) rotate(0deg); }
    50% { opacity: 1; transform: scale(1) rotate(180deg); }
  }
  
  .sparkle {
    position: fixed;
    pointer-events: none;
    z-index: 1000;
    animation: sparkle 1s ease-in-out;
  }

  .download-btn {
    background: #ffd700; /* gold */
    color: #8b0000;      /* maroon text */
    padding: 10px 20px;
    border-radius: 12px;
    text-decoration: none;
    font-weight: bold;
    box-shadow: 0 3px 6px rgba(0,0,0,0.2);
    transition: 0.2s;
}

.download-btn:hover {
    background: #ffc107;
    color: #4b0000;
    transform: translateY(-2px);
}

</style>
<body>
<header>
  <h1>iTeach PDU</h1>
  <p>"This is SPARTA"</p>
</header>

<div class="search-wrapper">
  <h2>üèÜ Unit 1 P-Coin Auction üèÜ</h2>
    <div class="search-box">
    <input id="studentName" placeholder="Start typing a student name..." oninput="autocompleteStudent()" autocomplete="off"/>
    <button>üîç</button>
    <div class="search-hint">üí° Tip: Type any part of the student's name to find them quickly!</div>
    <div class="loading-indicator">‚è≥</div>
  </div>
  <div id="autocompleteList"></div>
  <div id="studentInfo" style="display:none;">
    <h3 id="studentDetails" data-coins="0"></h3>
    <div id="prizeList">
      <h4> Prizes</h4>
      {% for prize, cost in prizes.items() %}
        <div class="card">
          {{ prize }} ({{ cost }} PCoins)
          <input type="number" min="0" value="0" class="prizeQty qtyInput" data-prize="{{ prize }}" data-cost="{{ cost }}" />
        </div>
      {% endfor %}
    </div>
    <br/>
    <button onclick="redeemPrizes()">Redeem</button>
  </div>
  <p id="message"></p>
  <div style="margin:20px 0; text-align:center;">
    <a href="/download/redemptions" class="download-btn">üì• Download Redemption Data</a>
</div>

</div>
<script>
let currentStudent = "";
let searchTimeout = null;
let isSearching = false;

function showMsg(text, cls=""){const el=document.getElementById("message");el.className=cls;el.textContent=text;}

function showLoading(show) {
  const loader = document.querySelector('.loading-indicator');
  if (show) {
    loader.classList.add('show');
    isSearching = true;
  } else {
    loader.classList.remove('show');
    isSearching = false;
  }
}

function autocompleteStudent(){
  const input = document.getElementById("studentName").value.trim();
  const listDiv = document.getElementById("autocompleteList");
  
  // Clear previous timeout
  if (searchTimeout) {
    clearTimeout(searchTimeout);
  }
  
  // Clear results if input is empty
  if (!input) {
    listDiv.innerHTML = "";
    showLoading(false);
    return;
  }
  
  // Show loading for longer queries
  if (input.length >= 2) {
    showLoading(true);
  }
  
  // Debounce search
  searchTimeout = setTimeout(() => {
    fetch("/search", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({name: input})
    })
    .then(r => r.json())
    .then(data => {
      showLoading(false);
      listDiv.innerHTML = "";
      
      if (data.matches && data.matches.length > 0) {
        data.matches.forEach(name => {
          const div = document.createElement("div");
          div.textContent = name;
          div.onclick = () => selectStudent(name);
          listDiv.appendChild(div);
        });
      } else if (data.name) {
        selectStudent(data.name);
      } else if (data.error) {
        const div = document.createElement("div");
        div.className = "no-results";
        div.innerHTML = `No students found matching "${input}"<br>Try a different name or check spelling`;
        listDiv.appendChild(div);
      }
    })
    .catch(err => {
      showLoading(false);
      console.error('Search error:', err);
      const div = document.createElement("div");
      div.className = "no-results";
      div.innerHTML = "Search temporarily unavailable<br>Please try again";
      listDiv.appendChild(div);
    });
  }, 300); // 300ms debounce
}

function selectStudent(name) {
  currentStudent = name;
  document.getElementById("studentName").value = name;
  document.getElementById("autocompleteList").innerHTML = "";
  showLoading(false);
  
  // Add visual feedback for selection
  const input = document.getElementById("studentName");
  input.style.borderColor = "#38a169";
  input.style.boxShadow = "0 0 0 3px rgba(56, 161, 105, 0.1)";
  
  setTimeout(() => {
    input.style.borderColor = "#667eea";
    input.style.boxShadow = "0 0 0 3px rgba(102, 126, 234, 0.1)";
  }, 1000);
  
  fetchStudentDetails(name);
}

// Add keyboard navigation
document.addEventListener('DOMContentLoaded', function() {
  const input = document.getElementById("studentName");
  let selectedIndex = -1;
  
  input.addEventListener('keydown', function(e) {
    const listDiv = document.getElementById("autocompleteList");
    const items = listDiv.querySelectorAll('div:not(.no-results)');
    
    if (e.key === 'ArrowDown') {
      e.preventDefault();
      selectedIndex = Math.min(selectedIndex + 1, items.length - 1);
      updateSelection(items);
    } else if (e.key === 'ArrowUp') {
      e.preventDefault();
      selectedIndex = Math.max(selectedIndex - 1, -1);
      updateSelection(items);
    } else if (e.key === 'Enter') {
      e.preventDefault();
      if (selectedIndex >= 0 && selectedIndex < items.length) {
        items[selectedIndex].click();
      }
    } else if (e.key === 'Escape') {
      listDiv.innerHTML = "";
      selectedIndex = -1;
      showLoading(false);
    } else {
      selectedIndex = -1; // Reset selection when typing
    }
  });
  
  function updateSelection(items) {
    items.forEach((item, index) => {
      if (index === selectedIndex) {
        item.style.background = 'linear-gradient(135deg, #667eea, #764ba2)';
        item.style.color = 'white';
        item.style.transform = 'translateX(5px)';
      } else {
        item.style.background = '';
        item.style.color = '';
        item.style.transform = '';
      }
    });
  }
});

function fetchStudentDetails(name){
  fetch("/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name})})
  .then(r=>r.json())
  .then(data=>{if(!data.error&&data.name){document.getElementById("studentDetails").innerText=`üí∞ ${data.name} ‚Äî ${data.coins} PCoins Available`;document.getElementById("studentDetails").dataset.coins=data.coins;document.getElementById("studentInfo").style.display="block";}});
}

function createSparkles() {
  for(let i = 0; i < 15; i++) {
    setTimeout(() => {
      const sparkle = document.createElement('div');
      sparkle.className = 'sparkle';
      sparkle.innerHTML = ['‚ú®', 'üåü', '‚≠ê', 'üí´'][Math.floor(Math.random() * 4)];
      sparkle.style.left = Math.random() * window.innerWidth + 'px';
      sparkle.style.top = Math.random() * window.innerHeight + 'px';
      sparkle.style.fontSize = (Math.random() * 20 + 15) + 'px';
      document.body.appendChild(sparkle);
      setTimeout(() => sparkle.remove(), 1000);
    }, i * 100);
  }
}

function redeemPrizes(){
  if(!currentStudent){showMsg("üîç Search for a student first to begin their reward journey!","error");return;}
  let prizes={}; let totalCost=0;
  document.querySelectorAll(".prizeQty").forEach(input=>{const qty=parseInt(input.value)||0;if(qty>0){const prize=input.dataset.prize;const cost=parseInt(input.dataset.cost);prizes[prize]=qty;totalCost+=qty*cost;}});
  if(Object.keys(prizes).length===0){showMsg("üéÅ Select at least one amazing prize to continue!","error");return;}
  const currentCoins=parseInt(document.getElementById("studentDetails").dataset.coins);
  if(totalCost>currentCoins){showMsg(`üí∞ Oops! You need ${totalCost} PCoins but only have ${currentCoins}. Keep earning to unlock more rewards!`,"error");return;}
  fetch("/redeem",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:currentStudent,prizes:prizes})})
  .then(r=>r.json())
  .then(data=>{if(data.error) showMsg("‚ùå " + data.error,"error");else{createSparkles();showMsg(`üéâ Congratulations! Your rewards have been unlocked! Remaining PCoins: ${data.remaining} ‚ú®`,"success");document.getElementById("studentDetails").innerText=`üí∞ ${currentStudent} ‚Äî ${data.remaining} PCoins`;document.getElementById("studentDetails").dataset.coins=data.remaining;document.querySelectorAll(".prizeQty").forEach(i=>i.value=0);}});
}
</script>
</body>
</html>
